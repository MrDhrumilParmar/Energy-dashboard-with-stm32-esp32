//******************************************************************************
//                              Version 1
//******************************************************************************

#pragma once
const char INDEX_HTML[] PROGMEM = R"rawliteral(
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motor System Dashboard</title>

<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background:#f2f5f7;
  margin:10px;
  zoom:0.9;
}
.container {
  display:flex;
  gap:12px;
}
.main {
  flex:3;
}
.side {
  flex:1;
}
.card {
  background:white;
  border-radius:10px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 14px rgba(0,0,0,0.08);
}
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.badge {
  background:#2ecc71;
  color:white;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
.metrics {
  display:flex;
  gap:18px;
  margin:10px 0;
}
.metric {
  text-align:center;
  font-size:12px;
}
.metric .value {
  font-size:22px;
  font-weight:700;
}
canvas {
  width:100%!important;
  height:140px!important;
}
button {
  width:100%;
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:8px;
  margin-bottom:10px;
}
.start { background:#2ecc71; color:white; }
.stop { background:#e74c3c; color:white; }
</style>
</head>

<body>
<h2>Motor System Dashboard</h2>
<div>ESP IP: <span id="ip"></span></div>

<div class="container">
<div class="main">

<!-- MOTOR 1 -->
<div class="card">
  <div class="header"><b>Motor 1 – Conveyor</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric"><div class="value" id="m1V">0</div>Voltage</div>
    <div class="metric"><div class="value" id="m1I">0</div>Current</div>
    <div class="metric"><div class="value" id="m1P">0</div>Power</div>
    <div class="metric"><div class="value" id="m1T">0</div>Temp</div>
  </div>
  <canvas id="c1"></canvas>
</div>

<!-- MOTOR 2 -->
<div class="card">
  <div class="header"><b>Motor 2 – Pump</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric"><div class="value" id="m2V">0</div>Voltage</div>
    <div class="metric"><div class="value" id="m2I">0</div>Current</div>
    <div class="metric"><div class="value" id="m2P">0</div>Power</div>
    <div class="metric"><div class="value" id="m2T">0</div>Temp</div>
  </div>
  <canvas id="c2"></canvas>
</div>

<!-- MOTOR 3 -->
<div class="card">
  <div class="header"><b>Motor 3 – Fan</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric"><div class="value" id="m3V">0</div>Voltage</div>
    <div class="metric"><div class="value" id="m3I">0</div>Current</div>
    <div class="metric"><div class="value" id="m3P">0</div>Power</div>
    <div class="metric"><div class="value" id="m3T">0</div>Temp</div>
  </div>
  <canvas id="c3"></canvas>
</div>

</div>

<!-- SIDE PANEL -->
<div class="side">
  <div class="card">
    <h3>Total System Power</h3>
    <div style="font-size:30px;font-weight:800" id="totalP">0 kW</div>
  </div>
  <div class="card">
    <button class="start">START SYSTEM</button>
    <button class="stop">STOP SYSTEM</button>
  </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('ip').innerText = location.hostname;
const ws = new WebSocket(`ws://${location.hostname}:81`);

function makeChart(id){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{ labels:[], datasets:[
      {label:'V', data:[], borderWidth:2},
      {label:'I', data:[], borderWidth:2},
      {label:'P', data:[], borderWidth:2}
    ]},
    options:{
      animation:false,
      scales:{ y:{ min:0, max:250 } },
      plugins:{ legend:{ display:false } }
    }
  });
}

const c1=makeChart('c1'), c2=makeChart('c2'), c3=makeChart('c3');
const MAX=120; // ~10 minutes @ 5s later

function push(chart,v,i,p){
  chart.data.labels.push('');
  chart.data.datasets[0].data.push(v);
  chart.data.datasets[1].data.push(i);
  chart.data.datasets[2].data.push(p);
  if(chart.data.labels.length>MAX){
    chart.data.labels.shift();
    chart.data.datasets.forEach(d=>d.data.shift());
  }
  chart.update();
}

ws.onmessage=e=>{
  const m=JSON.parse(e.data).motors;
  const arr=['M1','M2','M3'];
  let total=0;
  arr.forEach((k,idx)=>{
    const M=m[k]||{};
    const V=M.V||0, I=M.current_A||0, P=V*I/1000;
    const T=40+Math.random()*5;

    document.getElementById(`m${idx+1}V`).innerText=V+' V';
    document.getElementById(`m${idx+1}I`).innerText=I.toFixed(2)+' A';
    document.getElementById(`m${idx+1}P`).innerText=P.toFixed(2)+' kW';
    document.getElementById(`m${idx+1}T`).innerText=T.toFixed(1)+' °C';

    [c1,c2,c3][idx] && push([c1,c2,c3][idx],V,I,P);
    total+=P;
  });
  document.getElementById('totalP').innerText=total.toFixed(2)+' kW';
};
</script>
</body>
</html>
)rawliteral";


//******************************************************************************
//                              Version 2
//******************************************************************************

#pragma once
const char INDEX_HTML[] PROGMEM = R"rawliteral(
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Realtime Energy Monitoring</title>

<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background:#f2f5f7;
  margin:10px;
  zoom:0.85;
}
.container { display:flex; gap:12px; }
.main { flex:3; }
.side { flex:1; }

.card {
  background:white;
  border-radius:10px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 14px rgba(0,0,0,0.08);
}

.header { display:flex; justify-content:space-between; align-items:center; }
.badge { background:#2ecc71; color:white; padding:4px 10px; border-radius:999px; font-size:12px; }

.metrics { display:flex; gap:18px; margin:10px 0; }
.metric { text-align:center; font-size:12px; }
.metric .value { font-size:22px; font-weight:700; }

.v { color:#1f77b4; }
.i { color:#ff7f0e; }
.p { color:#9467bd; }
.t { color:#d62728; }

canvas { width:100%!important; height:140px!important; }

button {
  width:100%; padding:12px; font-size:16px;
  border:none; border-radius:8px; margin-bottom:10px;
}
.start { background:#2ecc71; color:white; }
.stop { background:#e74c3c; color:white; }

.log {
  font-family: monospace;
  font-size:12px;
  background:#111;
  color:#0f0;
  padding:10px;
  border-radius:6px;
  height:120px;
  overflow:hidden;
}
</style>
</head>

<body>
<h2>Realtime Energy Monitoring</h2>

<div class="container">
<div class="main">

<div class="card">
  <div class="header"><b>Motor 1 – Conveyor</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric v"><div class="value" id="m1V">0</div>Voltage</div>
    <div class="metric i"><div class="value" id="m1I">0</div>Current</div>
    <div class="metric p"><div class="value" id="m1P">0</div>Power</div>
    <div class="metric t"><div class="value" id="m1T">0</div>Temp</div>
  </div>
  <canvas id="c1"></canvas>
</div>

<div class="card">
  <div class="header"><b>Motor 2 – Pump</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric v"><div class="value" id="m2V">0</div>Voltage</div>
    <div class="metric i"><div class="value" id="m2I">0</div>Current</div>
    <div class="metric p"><div class="value" id="m2P">0</div>Power</div>
    <div class="metric t"><div class="value" id="m2T">0</div>Temp</div>
  </div>
  <canvas id="c2"></canvas>
</div>

<div class="card">
  <div class="header"><b>Motor 3 – Fan</b><span class="badge">Healthy</span></div>
  <div class="metrics">
    <div class="metric v"><div class="value" id="m3V">0</div>Voltage</div>
    <div class="metric i"><div class="value" id="m3I">0</div>Current</div>
    <div class="metric p"><div class="value" id="m3P">0</div>Power</div>
    <div class="metric t"><div class="value" id="m3T">0</div>Temp</div>
  </div>
  <canvas id="c3"></canvas>
</div>

</div>

<div class="side">
  <div class="card">
    <h3>Total System Power</h3>
    <div style="font-size:30px;font-weight:800" id="totalP">0 kW</div>
  </div>

  <div class="card">
    <button class="start">START SYSTEM</button>
    <button class="stop">STOP SYSTEM</button>
  </div>

  <div class="card">
    <h4>System Log</h4>
    <div class="log">
      [INFO] Motor 1 Healthy<br>
      [INFO] Motor 2 Healthy<br>
      [INFO] Motor 3 Healthy<br>
    </div>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const UI_UPDATE_MS = 500; // <-- ADJUST DASHBOARD RATE HERE
let latestData = null;

const ws = new WebSocket(`ws://${location.hostname}:81`);
ws.onmessage = e => latestData = JSON.parse(e.data);

function makeChart(id){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{ labels:[], datasets:[{
      data:[], borderColor:'#1f77b4', borderWidth:2, pointRadius:0
    }]},
    options:{
      animation:false,
      responsive:true,
      maintainAspectRatio:false,
      scales:{
        x:{ grid:{ display:false } },
        y:{
          min:0, max:250,
          grid:{ color:'#e0e0e0' },
          ticks:{ font:{ size:12 } }
        }
      },
      plugins:{ legend:{ display:false } }
    }
  });
}

const charts=[makeChart('c1'),makeChart('c2'),makeChart('c3')];
const MAX=120;

setInterval(()=>{
  if(!latestData) return;
  const m=latestData.motors;
  let total=0;
  ['M1','M2','M3'].forEach((k,i)=>{
    const M=m[k]||{};
    const V=M.V||0, I=M.current_A||0;
    const P=V*I/1000;
    const T=40+Math.random()*5;

    document.getElementById(`m${i+1}V`).innerText=V+' V';
    document.getElementById(`m${i+1}I`).innerText=I.toFixed(2)+' A';
    document.getElementById(`m${i+1}P`).innerText=P.toFixed(2)+' kW';
    document.getElementById(`m${i+1}T`).innerText=T.toFixed(1)+' °C';

    const c=charts[i];
    c.data.labels.push('');
    c.data.datasets[0].data.push(V);
    if(c.data.labels.length>MAX){
      c.data.labels.shift();
      c.data.datasets[0].data.shift();
    }
    c.update();
    total+=P;
  });
  document.getElementById('totalP').innerText=total.toFixed(2)+' kW';
}, UI_UPDATE_MS);
</script>
</body>
</html>
)rawliteral";
